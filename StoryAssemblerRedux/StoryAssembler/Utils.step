RunStory ?frag:
    [StoryAssembler ?]
    # [Paragraph]
    # [StoryAssembler ?]
    # [Paragraph]
    # [StoryAssembler ?]
    # [Paragraph]
    # [StoryAssembler ?]
    # [Paragraph]
    # [StoryAssembler ?]
    # [Paragraph]
[end]

initially:
    [set ^CurrentScene = test]
    [set ^AddTemp = empty]
[end]

RunStoryWrap: [RunStory ?frag]

# Custom list operations

# Add an element to a list
Add ?element ?list ?new_list:
    [set ^AddTemp = ?list]
    [AddHelper ?element]
    [= ?new_list ^AddTemp]
[end]

SetUnion ?l1 ?l2 ?union:
    [set ^AddTemp = empty]
    [ForEach [Member ?x ?l1] [AddHelper ?x]]
    [ForEach [Member ?y ?l2] [Not [Member ?y ?l1]] [AddHelper ?y]]
    [= ?union ^AddTemp]
[end]

SetIntersection ?l1 ?l2 ?int:
    [set ^AddTemp = empty]
    [ForEach [Member ?x ?l1] [Member ?x ?l2] [AddHelper ?x]]
    [= ?int ^AddTemp]
[end]

Cat ?l1 ?l2 ?cat:
    [set ^AddTemp = empty]
    [ForEach [Member ?x ?l1] [AddHelper ?x]]
    [ForEach [Member ?y ?l2] [AddHelper ?y]]
    [= ?cat ^AddTemp]
[end]

AddHelper ?element:
    [add ?element ^AddTemp]
[end]

Reverse ?list ?reversed:
    [set ^AddTemp = empty]
    [ForEach [Member ?x ?list] [AddHelper ?x]]
    [= ?reversed ^AddTemp]
[end]

[predicate]
ToTuple ?a ?b ?tuple:
    [= ?tuple [?a ?b]]
[end]

# Custom max check
[predicate]
MaxOf ?x ?y ?max: [< ?x ?y] [set ?max = ?y]
MaxOf ?x ?y ?max: [set ?max = ?x]

SetupTestScene:
    [set CurrentScene = test]
    [InitScene ^CurrentScene]
[end]